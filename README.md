cleantools
==========
cleantools is a collection of tools for modeling and removing the effective beam response in data from the 
[ALFALFA survey](http://egg.astro.cornell.edu/index.php/).

Directory Structure
--------------------
Before the software can be configured and the cleantools module built, the files need to be moved to a directory called 
"deconvolution" that is under the IDL ALFALFA directory.  If this directory does not already exist, it needs to be created.

Compiling the Software
-----------------------
For added speed, cleantools needs a compiled C module that can be called from IDL.  The configuration and compiling of 
this module are accomplished with the `configure` script included with the software and the `make` command, respectively.  

The configure script,  run via `./configure`, has a variety of options, most of which are not important.  There are two,
however, that are.  The first is "--disable-openmp" which turns off OpenMP support.  OpenMP support is turned on by default 
and allows the C module to use multiple CPU/cores on machines that have them.  The OpenMP support, however, is limited to 
GCC >= 4.3.1 and the Intel C Compiler (ICC).  If you don't have either of these installed on your machine, you should use 
the "--disable-openmp" flag.  The other option that is of importance is the "--with-idl-inc=PATH" which specifies the path 
to the "idl_export.h" file.  By default, the configure script search the paths:

  * /usr/local/itt/idl/external/include
  * /usr/local/rsi/idl/external/include

for this file.  If your "idl_export.h" file is not in either of these paths, you should use this flag to tell the configure 
script where to find it.

Once the configure script has successfully completed and generated a "Makefile", the module can be compiled with the `make`
command.  `make` will create a three object files (*.o) and the cleantoools module "clean_tools.so".  There is no need to 
run `make install` at this point because all of the files are  already in the correct locations.

IDL Setup
---------
The final step is to modify the ".idlstartup" file to include the path the to cleantools software.  This requires adding 
the highlighted line listed below after the other ALFLFA path declarations.

```...
  !path = expand_path('+'+homedir+'eggidl')+':' +!path
  !path = expand_path('+'+homedir+'idl_alfa')+':' +!path
  !path = expand_path('+' + homedir + 'deconvolution') + ':' + !path
  !edit_input = 512
  device, true_color = 24
  ...
```

Testing the Installation
------------------------
After the software has been configured and installed, it can be tested by running the command `make test`.  This command runs 
a series of 15 tests on the cleantools package.  These tests include verifying that the IDL routines compile correctly and 
comparing the beams built by the routines and C module with accepted values.  If any part of this test sequence fails, the 
command will immediately abort.  Any errors that are detected will likely be related to loading the C module file, 
clean_tools.so into IDL.  If this occurs, check to see that the clean_tools.so file was generated by the `make` command, 
that clean_tools.so is in the correct directory,  and that the IDL path has been updated.

Documentation
-------------
Documentation of the various routines in cleantools is provided in the `docs` directory.
